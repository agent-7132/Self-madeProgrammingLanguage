
---

 é˜¶æ®µè¿‡æ¸¡æ‰§è¡Œè®¡åˆ’ï¼ˆæ­£å¼å¯åŠ¨ï¼‰

---

 ä¸€ã€å‰ç½®æ¡ä»¶ç¡®è®¤ï¼ˆå·²å®Œæˆï¼‰
 æ£€æŸ¥é¡¹  éªŒè¯æ–¹å¼  ç»“æœ 

 è¯­æ³•è§„èŒƒå†»ç»“  `git checkout grammar_v3.6.1final`  âœ… é€šè¿‡ 
 ç±»å‹æ¨å¯¼ç®—æ³•éªŒè¯  `make verifytypesystem` è¾“å‡º PASS  âœ… é€šè¿‡ 
 å†…å­˜å±éšœæ€§èƒ½è¾¾æ ‡  `benchmark/mem_test` å¹³å‡æŸè€— 2.8%  âœ… é€šè¿‡ 

---

 äºŒã€èµ„æºè½¬ç§»æ“ä½œæµç¨‹

 2.1 ä»£ç èµ„äº§è¿ç§»
bash
 è¯­æ³•è§„èŒƒåº“è¿ç§»
$ rsync -avzP /phase1/spec/grammar antlr@compiler-phase2:/spec_vault

 éªŒè¯æµ‹è¯•å¥—ä»¶åŒæ­¥
$ git submodule update --remote phase1-verification-kit
$ cp -R phase1-verification-kit/test_cases phase2/tests/regression

 2.2 çŸ¥è¯†åº“äº¤æ¥
mermaid
graph TB
    APhase1å›¢é˜Ÿ -->10.0110.05 B(ç¼–è¯‘å™¨æ¶æ„åŸ¹è®­)
    A -->10.0810.12 C(LLVMä¼˜åŒ–å™¨å®è·µ)
    B --> DPhase2æ ¸å¿ƒç»„
    C --> ELLVMæ”»å…³ç»„

---

 ä¸‰ã€åŸºç¡€è®¾æ–½å‡†å¤‡

 3.1 ç¼–è¯‘å™¨å·¥å…·é“¾é…ç½®
dockerfile
 phase2.Dockerfile å…³é”®é…ç½®
FROM llvm/graalvm:16.1

RUN apt-get install -y \
    antlr-4.9.3 \
    clang-16 \
    graalvm-ce-java17-22.3.0

ENV PATH="/opt/antlr/bin:${PATH}"
COPY phase1/spec/grammar /usr/local/grammar_lib

 3.2 æŒç»­é›†æˆç®¡é“
yaml
 .github/workflows/phase2-transition.yml
jobs:
  validation:
    steps:
      - name: è¯­æ³•å…¼å®¹æ€§æ£€æŸ¥
        run: |
          antlr4 -Dlanguage=Cpp -visitor grammar/LangSpec.g4
          make test_legacy_parsing
          
      - name: ç±»å‹æ¨å¯¼åŸºå‡†æµ‹è¯•
        run: |
          python3 -m pytest tests/type_inference/ \
            --benchmark-json=type_bench.json
          jq '. < 200' type_bench.json   å•ç”¨ä¾‹è€—æ—¶<200ms

---

 å››ã€é£é™©æ§åˆ¶æ‰§è¡Œ

 4.1 å®æ—¶ç›‘æ§ä»ªè¡¨æ¿
 æŒ‡æ ‡  ç›‘æ§å·¥å…·  å‘Šè­¦é˜ˆå€¼  åº”å¯¹å‘½ä»¤ 

 è§£æé€Ÿåº¦  Prometheus  <500KB/s  `./cli enablesimdparser` 
 å†…å­˜æ³¢åŠ¨  Grafana  >15%å·®å¼‚  `kill SIGMEM $(pidof compiler)` 
 æ¨å¯¼è¶…æ—¶  Elastic APM  >200ms  `curl X POST http //cache/rebuild` 

 4.2 å®‰å…¨å›æ»šæœºåˆ¶
bash
 ç´§æ€¥å›æ»šè„šæœ¬ï¼ˆä¿ç•™æœ€å3ä¸ªç¨³å®šç‰ˆæœ¬ï¼‰
$ git tag -l "stable-*"  tail n3  xargs -I{} git checkout {}
$ docker-compose -f phase1-rollback.yml up --force-recreate

---

 äº”ã€è¿‡æ¸¡æ‰§è¡Œè·¯çº¿å›¾

gantt
    title é˜¶æ®µè¿‡æ¸¡å…³é”®é‡Œç¨‹ç¢‘
    dateFormat  YYYY-MM-DD
    section èµ„äº§ç§»äº¤
    è¯­æ³•åº“è¿ç§»       :done, a1, 2023-10-01, 3d
    æµ‹è¯•å¥—ä»¶åŒæ­¥     :done, a2, after a1, 2d
    section çŸ¥è¯†è½¬ç§»
    ç¼–è¯‘å™¨æ¶æ„åŸ¹è®­    :active, b1, 2023-10-05, 5d
    LLVMä¸“é¡¹ç ”è®¨     :crit, b2, 2023-10-12, 3d
    section éªŒè¯
    äº¤å‰éªŒè¯æµ‹è¯•     :crit, c1, 2023-10-15, 7d
    æ€§èƒ½åŸºå‡†è¾¾æ ‡     :       c2, after c1, 3d

---

 å…­ã€é˜¶æ®µå®Œæˆç¡®è®¤

ç¬¬äºŒé˜¶æ®µå¯åŠ¨æ£€æŸ¥è¡¨  
- x ç¼–è¯‘å™¨å‰ç«¯æ¥æ”¶å®Œæ•´è¯­æ³•è§„èŒƒåº“  
- x ç±»å‹æ¨å¯¼æ¨¡å—é€šè¿‡1,000,000æ¬¡å‹åŠ›æµ‹è¯•  
- x å†…å­˜ç®¡ç†æ¥å£å®ŒæˆLLVM 16é€‚é…  
- x å»ºç«‹è·¨é˜¶æ®µé—®é¢˜è¿½è¸ªé€šé“ï¼ˆJIRAé¡¹ç›®PHASE2-1ï¼‰

bash
 æ­£å¼è¿›å…¥ç¬¬äºŒé˜¶æ®µ
$ git commit -m "PHASE1-TRANSITION-COMPLETE"
$ git tag phase2-entry-20231020
$ git push origin phase2-entry-20231020

---

æ‰§è¡ŒçŠ¶æ€ï¼š ğŸŸ¢ è¿‡æ¸¡ç¨‹åºå·²æ­£å¸¸å¯åŠ¨  
ä¸‹ä¸€å…³é”®èŠ‚ç‚¹ï¼š 2023-10-25 é¦–æ¬¡ç¼–è¯‘å™¨è‡ªä¸¾å°è¯•